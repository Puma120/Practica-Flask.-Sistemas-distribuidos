<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productos</title>
  <style>
    *{box-sizing:border-box;}
    body{margin:0;font-family:Arial,sans-serif;background:#f2f4f7;}
    
    /* Menu Hamburguesa */
    .navbar{background:#2563eb;padding:15px 20px;display:flex;align-items:center;justify-content:space-between;}
    .navbar h1{color:white;margin:0;font-size:20px;}
    .hamburger{cursor:pointer;display:flex;flex-direction:column;gap:5px;}
    .hamburger span{width:25px;height:3px;background:white;border-radius:2px;}
    .menu{position:fixed;top:0;right:-250px;width:250px;height:100%;background:#1e3a8a;transition:right 0.3s;z-index:1000;padding-top:60px;}
    .menu.active{right:0;}
    .menu a{display:block;color:white;padding:15px 20px;text-decoration:none;border-bottom:1px solid #3b5998;}
    .menu a:hover{background:#3b5998;}
    .menu-close{position:absolute;top:15px;right:15px;color:white;font-size:24px;cursor:pointer;}
    .overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:999;}
    .overlay.active{display:block;}
    
    .container{max-width:900px;margin:40px auto;padding:0 20px;}
    .box{background:white;padding:25px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.1);}
    h2{margin:0 0 15px 0;text-align:center;}
    
    .top{display:flex;justify-content:flex-end;margin-bottom:15px;}
    .btn{text-decoration:none;display:inline-block;padding:8px 12px;border-radius:6px;font-weight:bold;font-size:14px;border:none;cursor:pointer;}
    .btn-primary{background:#2563eb;color:white;}
    .btn-primary:hover{background:#1d4ed8;}
    .btn-gray{background:#e5e7eb;color:#111827;}
    .btn-gray:hover{background:#d1d5db;}
    .btn-danger{background:#dc2626;color:white;}
    .btn-danger:hover{background:#b91c1c;}
    
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{padding:10px;border:1px solid #ddd;font-size:14px;text-align:left;}
    th{background:#f7f7f7;}
    
    .msg{text-align:center;padding:10px;border-radius:6px;margin-bottom:12px;font-size:14px;}
    .success{background:#dcfce7;color:#166534;}
    .error{background:#fee2e2;color:#991b1b;}
    .empty{text-align:center;padding:20px;color:#555;}
    .inline{display:flex;gap:8px;}
  </style>
</head>
<body>
  <nav class="navbar">
    <h1>Sistema Productos</h1>
    <div class="hamburger" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>
  </nav>
  
  <div class="overlay" onclick="toggleMenu()"></div>
  <div class="menu">
    <span class="menu-close" onclick="toggleMenu()">&times;</span>
    <a href="{{ url_for('nuevo_producto') }}">Nuevo Producto</a>
    <a href="{{ url_for('listar_productos') }}">Ver Productos</a>
    <a href="{{ url_for('logout') }}">Cerrar Sesion</a>
  </div>

  <div class="container">
    <div class="box">
      <h2>Lista de Productos</h2>
      
      <div class="top">
        <a href="{{ url_for('nuevo_producto') }}" class="btn btn-primary">+ Nuevo</a>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            {% if cat == "success" %}
              <div class="msg success">{{ msg }}</div>
            {% else %}
              <div class="msg error">{{ msg }}</div>
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% if productos and productos|length > 0 %}
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Categoria</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Activo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for p in productos %}
            <tr>
              <td>{{ p.id }}</td>
              <td>{{ p.nombre }}</td>
              <td>{{ p.categoria or 'General' }}</td>
              <td>$ {{ "%.2f"|format(p.precio) }}</td>
              <td>{{ p.stock }}</td>
              <td>{{ "Si" if p.activo else "No" }}</td>
              <td>
                <div class="inline">
                  <a href="{{ url_for('editar_producto', id=p.id) }}" class="btn btn-gray">Editar</a>
                  <form method="POST" action="{{ url_for('eliminar_producto_route', id=p.id) }}" style="margin:0;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('Eliminar producto?');">
                      Eliminar
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="empty">No hay productos todavia.</div>
      {% endif %}
    </div>
  </div>

  <script>
    function toggleMenu(){
      document.querySelector('.menu').classList.toggle('active');
      document.querySelector('.overlay').classList.toggle('active');
    }
  </script>
</body>
</html>
